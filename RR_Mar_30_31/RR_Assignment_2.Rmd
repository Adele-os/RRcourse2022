---
title: "The Office"
author: 
  - Adele Ossareh^[University of Warsaw, a.ossareh@student.uw.edu.pl]
date: "30/3/2022"
output: 
  html_document:
    theme: united
    toc: true
    toc_float: true
---
First we need to load the required libraries
```{r, message=FALSE, warning=FALSE}
library(dplyr) # Data manipulation
library(ggplot2) # For plotting
library(rvest) # For web scraping
library(stringr) # Helping us with regex
```

```{r,include=FALSE, cache=TRUE}
url <- "https://en.wikipedia.org/wiki/The_Office_(American_TV_series)"
```

# Description 
[*The Office*](url) is an American mockumentary sitcom television series that depicts the everyday work lives of office employees in the *Scranton, Pennsylvania* branch of the fictional *Dunder Mifflin* Paper Company. It aired on **NBC** from March 24, 2005, to May 16, 2013, spanning a total of nine seasons. Based on the 2001â€“2003 **BBC** series of the same name created by *Ricky Gervais* and *Stephen Merchant*, it was adapted for American television by *Greg Daniels*, a veteran writer for *Saturday Night Live*, *King of the Hill*, and *The Simpsons*. 


# A shot or logo from the show
Below you can find a picture from the show

<img src=https://www.denofgeek.com/wp-content/uploads/2020/03/the-office-nbc.png?resize=768%2C432>

# Statistics summary
```{r, cache=TRUE, warning=FALSE, include=FALSE}
# The scraped table from Wikipedia
df <- url %>%
  read_html() %>% 
  html_nodes(xpath='//*[@id="mw-content-text"]/div[1]/table[4]/tbody') %>% 
  html_table(fill=TRUE)

# Targetting the required table
df <- df[[1]]


# the headers need to be cahnged
names(df) <- df[1,]

# Manipulatng the column names
df <- df[-1,] 
season_count <- nrow(df)
df[,c(6,7)] <- NULL
names(df[,5]) <- "Viewers(millions)"
# Fisrt we need to mutate some columns so that only the numeric parts are selected
df <- df %>%
  mutate(`Viewers(millions)` = str_extract(`Viewers(millions)`, "[^\\[]+"))

# Scraped values from the data table
df$`Viewers(millions)` <- as.numeric(df$`Viewers(millions)`)
max_viewers <- as.numeric(summary(df$`Viewers(millions)`)[6])
min_viewers <- as.numeric(summary(df$`Viewers(millions)`)[1])
avg_viewers <- round(as.numeric(summary(df$`Viewers(millions)`)[4]),2)
```

Based on the scraped data from [*The Office*](url) page in Wikipedia, we can see that the maximum number of the viewers was **`r max_viewers`** millions and the minimum was **`r min_viewers`** millions. Also the average number of the viewers from the calculated summary is **`r avg_viewers`** millions which shows that how successful the series was.

# A graph for the number of viewers by season
```{r, echo=FALSE, message=FALSE, warning=FALSE}
# First we need to extract the date in a correct format
df <- df %>%
  mutate(Date = str_extract(Date, "[^\\(]+")) 

# Now we need to change it to the date column
df$Date <- as.Date(df$Date, format = "%B %d, %Y")

# Plot
plot(df$Date,df$`Viewers(millions)`,
     type = 'l',
     col = 'blue', 
     lwd=2.0,
     ylab = "Viewers in millions", 
     xlab = "Year of season",
     main = "Number of viewers for each season across time", )
points(x = df$Date, y = df$`Viewers(millions)`, pch = 15, col = "red")
```